<!DOCTYPE html>





<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: 'search.xml'
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Feb 1997">
<meta property="og:url" content="http://xiaokeliu666.github.io/index.html">
<meta property="og:site_name" content="Feb 1997">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Feb 1997">
  <link rel="canonical" href="http://xiaokeliu666.github.io/">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Feb 1997</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <div class="container sidebar-position-left page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Feb 1997</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Overtime and overdue</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archives</a>

  </li>
        <li class="menu-item menu-item-search">
          <a href="javascript:;" class="popup-trigger">
          
            <i class="menu-item-icon fa fa-search fa-fw"></i> <br/>Search</a>
        </li>
      
    </ul>
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>

</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/17/Spring-Security-Define-secured-URLS-dynamically/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/17/Spring-Security-Define-secured-URLS-dynamically/" class="post-title-link" itemprop="url">Spring Security: Define secured URLS dynamically</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-17 14:53:15 / Modified: 16:28:06" itemprop="dateCreated datePublished" datetime="2020-08-17T14:53:15-04:00">2020-08-17</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>After browsing the official document of Spring Security, I found there is no such a solution to help with dynamically configure url authorization. By default, Spring Security will initialize the url authorization as the applilcation starts. </p>
<p>There is a question in the document <a href="https://link.jianshu.com/?t=https%3A%2F%2Fdocs.spring.io%2Fspring-security%2Fsite%2Fdocs%2F4.2.4.RELEASE%2Freference%2Fhtmlsingle%2F%23appendix-faq-dynamic-url-metadata" target="_blank" rel="noopener">44.4.6. How do I define the secured URLs within an application dynamically?</a>. After reading the solution to this problem, I draw a solution with two steps:</p>
<ol>
<li>Provide data which describes the rules of access.<br> <code>SecurityMetadataSource</code> obtains the metadata for a particular method or filter invocation</li>
<li>Customize an interceptor and add it into the Spring Security’s filterChain.</li>
</ol>
<h1 id="Authorization-datasource"><a href="#Authorization-datasource" class="headerlink" title="Authorization datasource"></a>Authorization datasource</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Config authentication data source to implement dynamically authorization load</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilterInvocationSecurityMetadataSource</span> <span class="keyword">implements</span> <span class="title">FilterInvocationSecurityMetadataSource</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Authorization data</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;RequestMatcher, Collection&lt;ConfigAttribute&gt;&gt; requestMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Find the authorization data according to current url in the initial authorization datasource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAttributes</span><span class="params">(Object object)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        FilterInvocation fi = (FilterInvocation) object;</span><br><span class="line">        HttpServletRequest request = fi.getRequest();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// traverse the initialized authorization data and find authorization according to current url</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;RequestMatcher, Collection&lt;ConfigAttribute&gt;&gt; entry : requestMap</span><br><span class="line">                .entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.getKey().matches(request)) &#123;</span><br><span class="line">                <span class="keyword">return</span> entry.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAllConfigAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FilterInvocation.class.isAssignableFrom(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Update authorization collection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRequestMap</span><span class="params">(List&lt;SysAuthorityVo&gt; authorityVoList)</span></span>&#123;</span><br><span class="line">        Map&lt;RequestMatcher, Collection&lt;ConfigAttribute&gt;&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SysAuthorityVo sysAuthorityVo : authorityVoList) &#123;</span><br><span class="line">            String authorityName = sysAuthorityVo.getAuthorityName();</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(sysAuthorityVo.getAuthorityContent())) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (String url : sysAuthorityVo.getAuthorityContent().split(<span class="string">","</span>)) &#123;</span><br><span class="line">                Collection&lt;ConfigAttribute&gt; value = map.get(<span class="keyword">new</span> AntPathRequestMatcher(url));</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isEmpty(value)) &#123;</span><br><span class="line">                    ArrayList&lt;ConfigAttribute&gt; configs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                    configs.add(<span class="keyword">new</span> SecurityConfig(authorityName));</span><br><span class="line">                    map.put(<span class="keyword">new</span> AntPathRequestMatcher(url), configs);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    value.add(<span class="keyword">new</span> SecurityConfig(authorityName));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.requestMap = map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Customize-Dynamically-Url-Interceptor"><a href="#Customize-Dynamically-Url-Interceptor" class="headerlink" title="Customize Dynamically Url Interceptor"></a>Customize Dynamically Url Interceptor</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  Customize DynamicallyUrlInterceptor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicallyUrlInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractSecurityInterceptor</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// label customized url interceptor has already been loaded</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILTER_APPLIED = <span class="string">"__spring_security_filterSecurityInterceptor_filterApplied_dynamically"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FilterInvocationSecurityMetadataSource securityMetadataSource;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> observeOncePerRequest = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getSecureObjectClass() &#123;</span><br><span class="line">        <span class="keyword">return</span> FilterInvocation.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        FilterInvocation fi = <span class="keyword">new</span> FilterInvocation(request, response, chain);</span><br><span class="line">        invoke(fi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterInvocationSecurityMetadataSource <span class="title">getSecurityMetadataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.securityMetadataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SecurityMetadataSource <span class="title">obtainSecurityMetadataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.securityMetadataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecurityMetadataSource</span><span class="params">(FilterInvocationSecurityMetadataSource newSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.securityMetadataSource = newSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccessDecisionManager</span><span class="params">(AccessDecisionManager accessDecisionManager)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setAccessDecisionManager(accessDecisionManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(FilterInvocation fi)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((fi.getRequest() != <span class="keyword">null</span>)</span><br><span class="line">                &amp;&amp; (fi.getRequest().getAttribute(FILTER_APPLIED) != <span class="keyword">null</span>)</span><br><span class="line">                &amp;&amp; observeOncePerRequest) &#123;</span><br><span class="line">            <span class="comment">// filter already applied to this request and user wants us to observe</span></span><br><span class="line">            <span class="comment">// once-per-request handling, so don't re-do security checking</span></span><br><span class="line">            fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// first time this request being called, so perform security checking</span></span><br><span class="line">            <span class="keyword">if</span> (fi.getRequest() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                fi.getRequest().setAttribute(FILTER_APPLIED, Boolean.TRUE);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            InterceptorStatusToken token = <span class="keyword">super</span>.beforeInvocation(fi);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">super</span>.finallyInvocation(token);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">super</span>.afterInvocation(token, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Decision-Manager"><a href="#Decision-Manager" class="headerlink" title="Decision Manager"></a>Decision Manager</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Decision Manager</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAccessDecisionManager</span> <span class="keyword">extends</span> <span class="title">AbstractAccessDecisionManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    MyAccessDecisionManager(List&lt;AccessDecisionVoter&lt;?&gt;&gt; decisionVoters) &#123;</span><br><span class="line">        <span class="keyword">super</span>(decisionVoters);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decide</span><span class="params">(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> deny = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (AccessDecisionVoter voter : getDecisionVoters()) &#123;</span><br><span class="line">            <span class="keyword">int</span> result = voter.vote(authentication, object, configAttributes);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Voter: "</span> + voter + <span class="string">", returned: "</span> + result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (result) &#123;</span><br><span class="line">                <span class="keyword">case</span> AccessDecisionVoter.ACCESS_GRANTED:</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> AccessDecisionVoter.ACCESS_DENIED:</span><br><span class="line">                    deny++;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (deny &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AccessDeniedException(messages.getMessage(</span><br><span class="line">                    <span class="string">"AbstractAccessDecisionManager.accessDenied"</span>, <span class="string">"Access is denied"</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// To get this far, every AccessDecisionVoter abstained</span></span><br><span class="line">        checkAllowIfAllAbstainDecisions();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring Security provided several authorization strategy, here we are using RoleVoter.</p>
<h1 id="Configure-filter"><a href="#Configure-filter" class="headerlink" title="Configure filter"></a>Configure filter</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DynamicallyUrlInterceptor <span class="title">dynamicallyUrlInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// Retrieve the datasource</span></span><br><span class="line">        List&lt;SysAuthorityVo&gt; authorityVoList = sysAuthorityService.list(<span class="keyword">new</span> SysAuthorityVo()).getData();</span><br><span class="line">        myFilterInvocationSecurityMetadataSource.setRequestMap(authorityVoList);</span><br><span class="line">        <span class="comment">// Initialize interceptor and load the datasource</span></span><br><span class="line">        DynamicallyUrlInterceptor interceptor = <span class="keyword">new</span> DynamicallyUrlInterceptor();</span><br><span class="line">        interceptor.setSecurityMetadataSource(myFilterInvocationSecurityMetadataSource);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Configure RoleVoter Strategy</span></span><br><span class="line">        List&lt;AccessDecisionVoter&lt;? extends Object&gt;&gt; decisionVoters = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        decisionVoters.add(<span class="keyword">new</span> RoleVoter());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set Access Decision Manager</span></span><br><span class="line">        interceptor.setAccessDecisionManager(<span class="keyword">new</span> MyAccessDecisionManager(decisionVoters));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Add-filter-into-Spring-Security’s-Filter"><a href="#Add-filter-into-Spring-Security’s-Filter" class="headerlink" title="Add filter into Spring Security’s Filter"></a>Add filter into Spring Security’s Filter</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http</span><br><span class="line">        <span class="comment">// customize the url access authority and read the authentication dynamically</span></span><br><span class="line"></span><br><span class="line">        .addFilterAfter(dynamicallyUrlInterceptor(), FilterSecurityInterceptor.class)</span><br><span class="line">        .authorizeRequests()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// permit all which means no limitation against authority</span></span><br><span class="line">        .antMatchers(<span class="string">"/favicon.ico"</span>,<span class="string">"/common/**"</span>, <span class="string">"/webjars/**"</span>, <span class="string">"/getVerifyCodeImage"</span>,<span class="string">"/error/*"</span>).permitAll()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// other interfaces are accessible only after login</span></span><br><span class="line">        .anyRequest().authenticated()</span><br><span class="line">        .and();</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/09/AWS-OCR-application-based-on-Lambda/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/09/AWS-OCR-application-based-on-Lambda/" class="post-title-link" itemprop="url">AWS: OCR application based on Lambda</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-09 18:46:14 / Modified: 23:07:59" itemprop="dateCreated datePublished" datetime="2020-08-09T18:46:14-04:00">2020-08-09</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Project-Description"><a href="#Project-Description" class="headerlink" title="Project Description"></a>Project Description</h1><p>This project utilizes Lambda and Rekognition to build an OCR application which can extract text information from the image.</p>
<h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><ul>
<li>Operating System: Windows 10 (Home Edition)</li>
<li>Tools:<ul>
<li>CMD with administrator privileges</li>
<li>Docker Desktop</li>
<li>AWS SAM CLI</li>
</ul>
</li>
<li>Language: Python 3.6</li>
</ul>
<h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><ol>
<li><p>Build Python virtual environment<br> One of the advantages of Python is rich libs. However, in order to avoid redundant libs and manage the project easily, we use virtual environment.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m venv ~/.venvs/aws_sam</span><br></pre></td></tr></table></figure>
</li>
<li><p>Use virtual environment<br>First entering Scripts folder, then run the <code>activate.bat</code> to use the virtual environment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Windows\System32\~\.venvs\aws_sam\Scripts</span><br><span class="line">activate.bat</span><br></pre></td></tr></table></figure>
<p>Once the result looks like:<br><code>(aws_sam) C:\Windows\System32\~\.venvs\aws_sam\Scripts&gt;</code><br>we have already start the virtual environment <code>aws_sam</code></p>
</li>
<li><p>Update environment</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pip setuptools wheel</span><br></pre></td></tr></table></figure>
</li>
<li><p>Install packages<br>Since we are using virtual environment, we only have two packages, pip and setuptools. So we need to install packages.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip3 install boto3 botocore -U</span><br><span class="line">pip3 install awscli -U</span><br><span class="line">pip3 install aws-sam-cli -U</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>boto3</strong>: Boto is the Amazon Web Services (AWS) SDK for Python. It enables Python developers to create, configure, and manage AWS services, such as EC2 and S3. Boto provides an easy to use, object-oriented API, as well as low-level access to AWS services.</li>
<li><strong>botocore</strong>: Botocore is a low-level interface to a growing number of Amazon Web Services. Botocore serves as the foundation for the AWS-CLI command line utilities. It will also play an important role in the boto3.x project.</li>
<li><strong>awscli</strong>: The AWS Command Line Interface (CLI) is a unified tool to manage your AWS services. With just one tool to download and configure, you can control multiple AWS services from the command line and automate them through scripts.</li>
<li><strong>aws-sam-cli</strong>: Use this tool to build serverless applications that are defined by AWS SAM templates. The CLI provides commands that enable you to verify that AWS SAM template files are written according to the specification, invoke Lambda functions locally, step-through debug Lambda functions, package and deploy serverless applications to the AWS Cloud, and so on. </li>
</ul>
</li>
</ol>
<h1 id="Build-project"><a href="#Build-project" class="headerlink" title="Build project"></a>Build project</h1><ol>
<li><p>Download code from Github</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sam init</span><br></pre></td></tr></table></figure>
</li>
<li><p>Build project</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sam build</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h1><ol>
<li><p>Package local environment<br> Since the environment of Lambda is too complicated to simulate locally, here we use docker container to build the project. In Docker-hub, there is already an image of <a href="(https://hub.docker.com/r/lambci/lambda/">docker-lambda</a>)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sam build --use-container</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create an S3 bucket</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 mb s3://my-lambda-ocr-repo</span><br></pre></td></tr></table></figure>
</li>
<li><p>Package</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sam package --template-file template.yaml --output-template-file packaged.yaml --s3-bucket my-lambda-ocr-repo</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>After excuting, a configuration file will be created in S3 bucket.</p>
<ol>
<li><p>Deploy to Lambda</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sam deploy --template-file packaged.yaml --stack-name aws-sam-ocr --capabilities CAPABILITY_IAM --region us-east-1</span><br></pre></td></tr></table></figure>
<p> In this step, CloudFormation is used to build (template.yaml), so stack name is required. By excuting this step, we will create: table of dynamoDB, S3 bucket and Lambda function.<br> We can monitor the process of deployment in AWS -&gt; CloudFormation -&gt; Stacks</p>
</li>
</ol>
<h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><ol>
<li><p>Upload picture to bucket<br> First, we prepare a folder called “pic” to store pictures<br> There are two buckets relative to this project. The first one is which we upload file to and the second one is where stored the configuration file.<br> <img src="//xiaokeliu666.github.io/2020/08/09/AWS-OCR-application-based-on-Lambda/bucket.jpg" alt><br> So, we upload picture to the first bucket</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3 cp pic/news.jpg s3://aws-lambda-ocr-sourceimagebucket-dqrx1qpra9wr</span><br></pre></td></tr></table></figure>
</li>
<li><p>Find the result in dynamoDB<br><strong>news.jpg</strong>:<br><img src="//xiaokeliu666.github.io/2020/08/09/AWS-OCR-application-based-on-Lambda/news.jpg" alt><br><strong>Result</strong>:<br><img src="//xiaokeliu666.github.io/2020/08/09/AWS-OCR-application-based-on-Lambda/result.jpg" alt></p>
</li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/09/AWS-Lambda/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/09/AWS-Lambda/" class="post-title-link" itemprop="url">AWS: Lambda</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-09 18:12:31 / Modified: 18:45:30" itemprop="dateCreated datePublished" datetime="2020-08-09T18:12:31-04:00">2020-08-09</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>Before diving into Lambda, a new concept, <strong>Serverless Computing</strong>, should be introduced.</p>
<h1 id="Serverless-Computing"><a href="#Serverless-Computing" class="headerlink" title="Serverless Computing"></a>Serverless Computing</h1><p>Serverless computing is a cloud computing execution model in which the cloud provider runs the server, and dynamically manages the allocation of machine resources. Pricing is based on the actual amount of resources consumed by an application, rather than on pre-purchased units of capacity. It can be a form of utility computing.</p>
<p>Serverless computing can simplify the process of deploying code into production. Scaling, capacity planning and maintenance operations may be hidden from the developer or operator. Serverless code can be used in conjunction with code deployed in traditional styles, such as microservices. Alternatively, applications can be written to be purely serverless and use no provisioned servers at all.</p>
<h1 id="Why-AWS-Lambda"><a href="#Why-AWS-Lambda" class="headerlink" title="Why AWS Lambda"></a>Why AWS Lambda</h1><h2 id="Amazon-EC2"><a href="#Amazon-EC2" class="headerlink" title="Amazon EC2"></a>Amazon EC2</h2><ul>
<li>Virtual Servers in the Cloud</li>
<li>Limited by RAM and CPU</li>
<li>Continuously running</li>
<li>Scaling means intervention to add / remove servers<h2 id="Amazon-Lambda"><a href="#Amazon-Lambda" class="headerlink" title="Amazon Lambda"></a>Amazon Lambda</h2></li>
<li>Virtual functions - no servers to manage</li>
<li>Limited by time - short executions</li>
<li>Run on-demand</li>
<li>Scaling is automated<h2 id="Benefits-of-AWS-Lambda"><a href="#Benefits-of-AWS-Lambda" class="headerlink" title="Benefits of AWS Lambda"></a>Benefits of AWS Lambda</h2></li>
<li>Easy pricing</li>
<li>Integrated with the whole AWS suite of services</li>
<li>Event-Driven: functions get invoked by AWS when needed</li>
<li>Integrated with many programming language</li>
<li>Easy monitoring through AWS CloudWatch</li>
<li>Easy to get more resources per functions(up to 3GB of RAM)</li>
<li>Increasing RAM will also improve CPU and network</li>
</ul>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/09/AWS-S3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/09/AWS-S3/" class="post-title-link" itemprop="url">AWS: S3</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-09 13:56:51 / Modified: 18:06:38" itemprop="dateCreated datePublished" datetime="2020-08-09T13:56:51-04:00">2020-08-09</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>S3 is advertised as <strong>infinitely scaling</strong> storage</p>
<h1 id="S3-Use-Cases"><a href="#S3-Use-Cases" class="headerlink" title="S3 Use Cases"></a>S3 Use Cases</h1><ul>
<li>Backup and storage</li>
<li>Disaster Recovery</li>
<li>Archive</li>
<li>Hybrid Cloud storage</li>
<li>Application hosting</li>
<li>Media hosting</li>
<li>Data lakes &amp; big data analytics</li>
<li>Software delivery</li>
<li>Static website</li>
</ul>
<h1 id="Buckets"><a href="#Buckets" class="headerlink" title="Buckets"></a>Buckets</h1><ul>
<li>Amazon S3 allows people to store objects(files) in “buckets” (directories)</li>
<li>Buckets must have a globally unique name (across all regions all accounts)</li>
<li>Buckets are defined at the region level</li>
<li>S3 looks like a global service but buckets are created in a region</li>
<li>Objects(Files) have a key. The key is the full path:<ul>
<li>s3://my-bucket/my_file.txt</li>
<li>s3://my-bucket/my_folder/anoter_folder/my_file.txt</li>
</ul>
</li>
<li>There’s no concept of “directories” within buckets<h2 id="Buckets-Policies"><a href="#Buckets-Policies" class="headerlink" title="Buckets Policies"></a>Buckets Policies</h2></li>
<li>JSON based policies<ul>
<li>Resources: buckets and objects</li>
<li>Actions: Set of API to Allow or Deny</li>
<li>Effect: Allow / Deny</li>
<li>Principal: The account or user to apply the policy to<br>Example:<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Version"</span>: <span class="string">"2012-10-17"</span>,</span><br><span class="line">    <span class="attr">"Statement"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"Sid"</span>: <span class="string">"PublicRead"</span>,</span><br><span class="line">            <span class="attr">"Effect"</span>: <span class="string">"Allow"</span>,</span><br><span class="line">            <span class="attr">"Principal"</span>: <span class="string">"*"</span>,</span><br><span class="line">            <span class="attr">"Action"</span>: [</span><br><span class="line">                <span class="string">"s3:GetObject"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"Resource"</span>: [</span><br><span class="line">                <span class="string">"arn:aws:s3:::examplebucket/*"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/09/AWS-EC2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/09/AWS-EC2/" class="post-title-link" itemprop="url">AWS: EC2</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-09 12:21:04 / Modified: 13:56:17" itemprop="dateCreated datePublished" datetime="2020-08-09T12:21:04-04:00">2020-08-09</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="EC2"><a href="#EC2" class="headerlink" title="EC2"></a>EC2</h1><ul>
<li>EC2 = Elastic Compute Cloud = Infrastructure as a Service</li>
<li>It mainly consists in the capability of :<ul>
<li>Renting virtual machines (EC2)</li>
<li>Storing data on virtual drives (EBS)</li>
<li>Distributing load across machines (ELB)</li>
<li>Scaling the services using an auto-scaling group (ASG)</li>
</ul>
</li>
</ul>
<h1 id="EC2-sizing-amp-confituration-options"><a href="#EC2-sizing-amp-confituration-options" class="headerlink" title="EC2 sizing &amp; confituration options"></a>EC2 sizing &amp; confituration options</h1><ul>
<li>Operating System: Linux or Windows</li>
<li>CPU</li>
<li>RAM</li>
<li>Storage space<ul>
<li>network-attached (EBS &amp; EFS)</li>
<li>hardware (EC2 Instance Store)</li>
</ul>
</li>
<li>Network card: speed of the card, Public IP address</li>
<li>Firewall rules: security group</li>
<li>Bootstrap script (configure at first launch): EC2 User Data</li>
</ul>
<h1 id="Security-Groups"><a href="#Security-Groups" class="headerlink" title="Security Groups"></a>Security Groups</h1><ul>
<li>Security groups control how traffic is allowed into or out of our EC2 Instances</li>
<li>Security groups only contain allow rules</li>
<li>Security groups rules can refernce by IP or by security group</li>
<li>Security groups regulate:<ul>
<li>Access to Ports</li>
<li>Authorised IP ranges - IPv4 and IPv6</li>
<li>Control of inbound network (from other to the instance)</li>
<li>Control of outbound network (from the instance to other)</li>
</ul>
</li>
</ul>
<h1 id="Classic-Ports"><a href="#Classic-Ports" class="headerlink" title="Classic Ports"></a>Classic Ports</h1><ul>
<li>22 = SSH (Secure Shell) - log into a Linux instance</li>
<li>21 = FTP (File Transport Protocol) - upload files into a file share</li>
<li>22 = SFTP (Secure File Transport Protocol) - upload files using SSH</li>
<li>80 = HTTP - access unsecured websites</li>
<li>443 = HTTPS - access secured websites</li>
<li>3389 = RDP (Remote Desktop Protocol) - log into a Windows instance</li>
</ul>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/08/Docker-Install-on-Windows10-Home-edition/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/08/Docker-Install-on-Windows10-Home-edition/" class="post-title-link" itemprop="url">Docker: Install on Windows10 (Home edition)</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-08 23:54:04" itemprop="dateCreated datePublished" datetime="2020-08-08T23:54:04-04:00">2020-08-08</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-08-09 00:34:04" itemprop="dateModified" datetime="2020-08-09T00:34:04-04:00">2020-08-09</time>
              </span>
            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>During the process of developing my OCR application on AWS, I needed to use container to build my project. However, Docker doesn’t support Windows10 (Home edition) perfectly. Using Docker toolbox can be a solution but I failed. So, I take this note to record the steps and mistakes I made to install Docker Desktop.</p>
<h1 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h1><ol>
<li><p>Generate a file <code>hyperv.cmd</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pushd &quot;%~dp0&quot;</span><br><span class="line"></span><br><span class="line">dir /b %SystemRoot%\servicing\Packages\*Hyper-V*.mum &gt;hyper-v.txt</span><br><span class="line"></span><br><span class="line">for /f %%i in (&apos;findstr /i . hyper-v.txt 2^&gt;nul&apos;) do dism /online /norestart /add-package:&quot;%SystemRoot%\servicing\Packages\%%i&quot;</span><br><span class="line"></span><br><span class="line">del hyper-v.txt</span><br><span class="line"></span><br><span class="line">Dism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run <code>hyperv.cmd</code> with administrator privileges and restart may be required.</p>
</li>
<li>Turn on Windows features Hyper-V (Control Panel: Turn Windows features on or off)<br><img src="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/reference/media/hyper_v_feature_screenshot.png" alt></li>
<li>“Change” the edition of Windows<br>Here we don’t really change the edition, we just change the value in registery. Run Command Line with administrator privileges:<br><code>REG ADD &quot;HKEY_LOCAL_MACHINE\software\Microsoft\Windows NT\CurrentVersion&quot; /v EditionId /T REG_EXPAND_SZ /d Professional /F</code></li>
<li>Download Docker on <a href="https://store.docker.com/editions/community/docker-ce-desktop-windows" target="_blank" rel="noopener">https://store.docker.com/editions/community/docker-ce-desktop-windows</a></li>
</ol>
<h1 id="Mistake"><a href="#Mistake" class="headerlink" title="Mistake"></a>Mistake</h1><p>Q. “Error with docker-compose: docker-credential-desktop not installed or not available in PATH”<br>A. There is an typo in the <code>~/.docker/config.json</code>:”credSstore” instead of “credsStore”. This is not an issue only happens to me because I found the solution on <a href="https://github.com/docker/for-mac/issues/3785" target="_blank" rel="noopener">Github</a>. Obviously, this typo exists not only Windows but also MacOS</p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/08/AWS-Traditional-IT-vs-Cloud-Computing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/08/AWS-Traditional-IT-vs-Cloud-Computing/" class="post-title-link" itemprop="url">AWS: Traditional IT vs Cloud Computing</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-08 16:46:50 / Modified: 23:47:36" itemprop="dateCreated datePublished" datetime="2020-08-08T16:46:50-04:00">2020-08-08</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="What-is-a-server-composed-of"><a href="#What-is-a-server-composed-of" class="headerlink" title="What is a server composed of?"></a>What is a server composed of?</h1><ul>
<li>Compute: CPU</li>
<li>Memory: RAM</li>
<li>Storage: Data</li>
<li>Database: Store data in a structured way</li>
<li>Network: Routers, switch, DNS server<ul>
<li>Network: cables, routers and servers connected with each other</li>
<li>Router: A networking device that forwards data packets between computer networks. They know where to send your packets on the internet</li>
<li>Switch: Takes a packet and send it to the correct server / client on your network</li>
</ul>
</li>
</ul>
<h1 id="Problems-with-traditional-IT-approach"><a href="#Problems-with-traditional-IT-approach" class="headerlink" title="Problems with traditional IT approach"></a>Problems with traditional IT approach</h1><ul>
<li>Pay for the rent for the data center</li>
<li>Pay for the power supply, cooling, maintenance</li>
<li>Adding and replacing hardware takes time</li>
<li>Scaling is limited</li>
<li>Hire 24/7 team to monitor the infrastructure</li>
<li>How to deal with disasters? (earthquake, power shutdown, fire…)</li>
</ul>
<h1 id="What-is-Cloud-Computing"><a href="#What-is-Cloud-Computing" class="headerlink" title="What is Cloud Computing?"></a>What is Cloud Computing?</h1><ul>
<li>Cloud computing is the <strong>on-demand delivery</strong> of computer power, datebase storage, applications, and other IT resources</li>
<li>Through a cloud services platform with <strong>pay-as-you-go pricing</strong></li>
<li>You can provision exactly the right type and size of computing resources you need</li>
<li>You can access as many resources as you need, <strong>almost instantly</strong></li>
<li>Simple way to access <strong>servers, storage, databases and a set of application services</strong></li>
<li>Amazon Web Services owns and maintains the network-connected hardware required for these application services, while you provision and use what you need via a web application.</li>
</ul>
<h1 id="Five-Characteristics-of-Cloud-Computing"><a href="#Five-Characteristics-of-Cloud-Computing" class="headerlink" title="Five Characteristics of Cloud Computing"></a>Five Characteristics of Cloud Computing</h1><ul>
<li>On-demand self service:<ul>
<li>Users can provision resources and use them without human interaction from the service provider</li>
</ul>
</li>
<li>Broad network access:<ul>
<li>Resources available over the network, and can be accessed by diverse client platforms</li>
</ul>
</li>
<li>Multi-tenancy and resource pooling:<ul>
<li>Multiple customers can share the same infrastructure and applications with security and privacy</li>
<li>Multiple customers are served from the same physical resources</li>
</ul>
</li>
<li>Rapid elasticity and scalability:<ul>
<li>Automatically and quickly acquire and dispose resources when needed</li>
<li>Quickly and easily scale based on demand</li>
</ul>
</li>
<li>Measured service:<ul>
<li>Usage is measured, users pay correctly for what they have used</li>
</ul>
</li>
</ul>
<h1 id="Six-Advantages-of-Cloud-Computing"><a href="#Six-Advantages-of-Cloud-Computing" class="headerlink" title="Six Advantages of Cloud Computing"></a>Six Advantages of Cloud Computing</h1><ul>
<li>Trade capital expense(CAPEX) for operational expense(OPEX)<ul>
<li>Pay On-Demand: don’t own hardware</li>
<li>Reduced Total Cost of Ownership(TCO) &amp; Operational Expense(OPEX)</li>
</ul>
</li>
<li>Benefit from massive economies of scale<ul>
<li>Prices are reduced as AWS is more efficient due to large scale</li>
</ul>
</li>
<li>Stop guessing capacity<ul>
<li>Scale based on actual measured usage</li>
</ul>
</li>
<li>Increase speed and agility</li>
<li>Stop spending money running and maintaining data centers</li>
<li>Go global in minutes: leverage the AWS global infrastructure</li>
</ul>
<h1 id="Type-of-Cloud-Computing"><a href="#Type-of-Cloud-Computing" class="headerlink" title="Type of Cloud Computing"></a>Type of Cloud Computing</h1><ul>
<li>Infrastructure as a Service (IaaS)<ul>
<li>Provides building blocks for cloud IT</li>
<li>Provides networking, computers, data storage space</li>
<li>Highest level of flexibility</li>
<li>Easy parallel with traditional on-premises IT</li>
</ul>
</li>
<li>Platform as a Service (PaaS)<ul>
<li>Removes the need for your organization to manage the underlying infrastructure</li>
<li>Focus on the deployment and management of your applications</li>
</ul>
</li>
<li>Software as a Service (SaaS)<ul>
<li>Completed product that is run and managed by the service provider</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/08/03/A-secure-scheme-for-data-exchange-AES-RSA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/08/03/A-secure-scheme-for-data-exchange-AES-RSA/" class="post-title-link" itemprop="url">A secure scheme for data exchange: AES + RSA</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-03 18:05:55" itemprop="dateCreated datePublished" datetime="2020-08-03T18:05:55-04:00">2020-08-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-08-04 16:29:45" itemprop="dateModified" datetime="2020-08-04T16:29:45-04:00">2020-08-04</time>
              </span>
            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h1><p> The algorithm described by AES is a <strong>symmetric-key algorithm</strong>, meaning the same key is used for both encrypting and decrypting the data.</p>
<p> Symmetric encryption is a type of encryption where <strong>only one key</strong> (a secret key) is used to both encrypt and decrypt electronic information. The entities communicating via symmetric encryption must exchange the key so that it can be used in the decryption process.</p>
<h1 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h1><p>Asymmetric Encryption is a form of Encryption where <strong>keys come in pairs</strong>. What <strong>one key encrypts, only the other can decrypt</strong>. Frequently (but not necessarily), the keys are interchangeable, in the sense that if key A encrypts a message, then B can decrypt it, and if key B encrypts a message, then key A can decrypt it.</p>
<h1 id="Hybrid-Cryptosystem"><a href="#Hybrid-Cryptosystem" class="headerlink" title="Hybrid Cryptosystem"></a>Hybrid Cryptosystem</h1><h2 id="Interface-data-encyrption"><a href="#Interface-data-encyrption" class="headerlink" title="Interface data encyrption"></a>Interface data encyrption</h2><p>Steps:</p>
<ol>
<li>Client starts and sends request to server.</li>
<li>Server generates a pair of keys(pubKey1 and priKey1) with RSA.</li>
<li>Server sends pubKey1 back to client.</li>
<li>Client generates a pair of keys(pubKey2 and priKey2) with RSA.</li>
<li>Client encrypts pubKey2 with pubKey1.</li>
<li>Client sends pubKey2 back to server.</li>
<li>Server decrypts the ciphertext with priKey1 to get pubKey2. (Because the ciphertext is encrypted by pubKey1)</li>
<li>Server generates symmetric encryption whose length is 16 with AES.</li>
<li>Server encrypts the AES key with pubKey2 and sends to client.</li>
<li>Client decrypts the AES key with priKey2 to get AES key.</li>
<li>Finally, using encrypted key to do the encryption of data transmision.</li>
</ol>
<p>Note:</p>
<ol>
<li>RSA is asymmetric encryption: public key encrypts while private key decrypts.</li>
<li>AES is symmetric encryption: the same key is used for both encrypting and decrypting the data.</li>
<li>Since there is a limitation against size when using RSA, so segmentation is required.</li>
<li>Use the public key of RSA to encrypt AES, then use AES to decrypt/encrypt the content.</li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/07/27/Spring-REST-6-CRUD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/07/27/Spring-REST-6-CRUD/" class="post-title-link" itemprop="url">Spring REST 6: CRUD</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-07-27 20:50:43 / Modified: 21:37:52" itemprop="dateCreated datePublished" datetime="2020-07-27T20:50:43-04:00">2020-07-27</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h1><h2 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h2><p>The @RestController annotation was introduced in Spring 4.0 to <strong>simplify the creation of RESTful web services</strong>. It’s a convenience annotation that combines @Controller and @ResponseBody – which eliminates the need to annotate every request handling method of the controller class with the @ResponseBody annotation.</p>
<h2 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h2><p>While @RequestParams <strong>extract values from the query string</strong>, @PathVariables <strong>extract values from the URI path</strong>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/foos/&#123;id&#125;"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFooById</span><span class="params">(@PathVariable String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"ID: "</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>For @PathVariable, we map on path:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/foos/abc</span><br><span class="line">----</span><br><span class="line">ID: abc</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/foos"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getFooByIdUsingQueryParam</span><span class="params">(@RequestParam String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"ID: "</span> + id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For @RequestParam, we map on path:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/foos?id=abc</span><br><span class="line">----</span><br><span class="line">ID: abc</span><br></pre></td></tr></table></figure></p>
<h2 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h2><p>Simply put, the @RequestBody annotation <strong>maps the HttpRequest body</strong> to a transfer or domain object, enabling automatic deserialization of the inbound HttpRequest body onto a Java object.</p>
<h1 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h1><h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/saveCustomer"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">saveCustomer</span><span class="params">(@RequestBody Customer theCustomer)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        save the customer using our service</span></span><br><span class="line">        theCustomer.setId(<span class="number">0</span>);</span><br><span class="line">        customerService.saveCustomer(theCustomer);</span><br><span class="line">        <span class="keyword">return</span> theCustomer;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/search/&#123;theSearchName&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">search</span><span class="params">(@PathVariable String theSearchName)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// search customers from the service</span></span><br><span class="line">    List&lt;Customer&gt; theCustomers = customerService.searchCustomers(theSearchName);</span><br><span class="line">    <span class="keyword">return</span> theCustomers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/delete/&#123;customerId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(@PathVariable <span class="keyword">int</span> customerId)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Customer tempCustomer = customerService.getCustomer(customerId);</span></span><br><span class="line">        customerService.delete(customerId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Delete customer id:"</span> + customerId;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="PUT"><a href="#PUT" class="headerlink" title="PUT"></a>PUT</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span>(<span class="string">"/updateCustomer"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">updateCustomer</span><span class="params">(@RequestBody Customer theCustomer)</span> </span>&#123;</span><br><span class="line">    customerService.saveCustomer(theCustomer);</span><br><span class="line">    <span class="keyword">return</span> theCustomer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>For get/delete testing, just input the uri and select the right method.<br>For put/post testing, besides the steps above:</p>
<ul>
<li>Select ‘Body’</li>
<li>Select ‘raw’</li>
<li>Select ‘JSON’</li>
<li>Input data in JSON fashion</li>
<li>Send request</li>
</ul>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xiaokeliu666.github.io/2020/07/25/Spring-REST-5-PathVariable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Feb 1997">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Feb 1997">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2020/07/25/Spring-REST-5-PathVariable/" class="post-title-link" itemprop="url">Spring REST 5: @PathVariable</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-07-25 21:01:02 / Modified: 21:22:52" itemprop="dateCreated datePublished" datetime="2020-07-25T21:01:02-04:00">2020-07-25</time>
            </span>
          
            

            
          

          <br/>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>Previously, we used @RestController to handle the REST request to get the list of students(<a href="http://localhost:8080/api/students" target="_blank" rel="noopener">http://localhost:8080/api/students</a>).<br>Now, assume we have a list of students, and the client only wants the first one. So we need to retrieve a single student by id: api/getStudentById/{studentId}</p>
<h1 id="Behind-the-scenes"><a href="#Behind-the-scenes" class="headerlink" title="Behind the scenes"></a>Behind the scenes</h1><ol>
<li>We’ll make a request across for /api/students/{studentId}</li>
<li>We’ll have Spring REST along with Jackson and they’ll make a call to the REST service</li>
<li>In our code, we’ll actually return that given student</li>
<li>Jackson will actually convert that student object or that student POJO to JSON and then send it back across to the REST client<h1 id="Development-Process"><a href="#Development-Process" class="headerlink" title="Development Process"></a>Development Process</h1></li>
</ol>
<ul>
<li><p>Add request mapping to Spring REST Service</p>
<ul>
<li>Bind path variable to method parameter using @PathVariable<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/getStudentById/&#123;studentId&#125;"</span>)</span><br><span class="line">    &lt;!-- <span class="function">the parameter should be the same as the content in the <span class="title">bracket</span><span class="params">(studentId)</span> --&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> Student <span class="title">getStudentById</span><span class="params">(@PathVariable <span class="keyword">int</span> studentId)</span> </span>&#123;</span><br><span class="line">    List&lt;Student&gt; theStudents = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    theStudents.add(<span class="keyword">new</span> Student(<span class="string">"Poornima"</span>,<span class="string">"Patel"</span>));</span><br><span class="line">    theStudents.add(<span class="keyword">new</span> Student(<span class="string">"Mario"</span>,<span class="string">"Rossi"</span>));</span><br><span class="line">    theStudents.add(<span class="keyword">new</span> Student(<span class="string">"Mary"</span>,<span class="string">"Smith"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> theStudents.get(studentId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Test<br>Postman:<br>GET:<a href="http://localhost:8080/SpringRESTDemo_war_exploded/api/getStudentById/1" target="_blank" rel="noopener">http://localhost:8080/SpringRESTDemo_war_exploded/api/getStudentById/1</a></p>
</li>
</ul>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.jpg"
      alt="Feb 1997">
  <p class="site-author-name" itemprop="name">Feb 1997</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">111</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>



        </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Feb 1997</span>
</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  <script src="/js/utils.js?v=7.2.0"></script>
  <script src="/js/motion.js?v=7.2.0"></script>

  
  <script src="/js/affix.js?v=7.2.0"></script>
  <script src="/js/schemes/pisces.js?v=7.2.0"></script>


  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  





  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  



















  <script src="/js/local-search.js?v=7.2.0"></script>














</body>
</html>
